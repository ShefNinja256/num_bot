import openai
from config import OPENAI_API_KEY

openai.api_key = OPENAI_API_KEY

def gpt_interpret(numbers: dict) -> str:
    prompt = (
        "–¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –Ω—É–º–µ—Ä–æ–ª–æ–≥ —Å –æ–ø—ã—Ç–æ–º –±–æ–ª–µ–µ 20 –ª–µ—Ç. "
        "–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî —Å–¥–µ–ª–∞—Ç—å –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â—É—é –∏ –ø–æ–Ω—è—Ç–Ω—É—é –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é —á–∏—Å–µ–ª —á–µ–ª–æ–≤–µ–∫–∞.\n\n"
        "–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:\n"
        "1) –î–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∏—Å–ª–∞ (—Å—É–¥—å–±—ã, –¥—É—à–∏, –ª–∏—á–Ω–æ—Å—Ç–∏, –∑—Ä–µ–ª–æ—Å—Ç–∏) ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞–±–∑–∞—Ü.\n"
        "- –°–Ω–∞—á–∞–ª–∞ –æ–±—ä—è—Å–Ω–∏, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —á–∏—Å–ª–æ.\n"
        "- –î–∞–π —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã, —Ç–∞–ª–∞–Ω—Ç—ã.\n"
        "- –£–∫–∞–∂–∏ —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞, –Ω–∞–¥ —á–µ–º —Å—Ç–æ–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.\n"
        "2) –í –∫–æ–Ω—Ü–µ —Å–¥–µ–ª–∞–π –æ–±—â–∏–π –≤—ã–≤–æ–¥ –æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–µ –∏ –∂–∏–∑–Ω–µ–Ω–Ω–æ–º –ø—É—Ç–∏ —á–µ–ª–æ–≤–µ–∫–∞.\n"
        "3) –ü–∏—à–∏ –≤ —Å—Ç–∏–ª–µ –ª—ë–≥–∫–æ–π —ç–∑–æ—Ç–µ—Ä–∏–∫–∏ (–¥—Ä—É–∂–µ–ª—é–±–Ω–æ, –º—É–¥—Ä–æ, –Ω–æ –±–µ–∑ –ª–∏—à–Ω–µ–π –º–∏—Å—Ç–∏–∫–∏).\n\n"
        f"–ß–∏—Å–ª–æ —Å—É–¥—å–±—ã: {numbers['—Å—É–¥—å–±—ã']}\n"
        f"–ß–∏—Å–ª–æ –¥—É—à–∏: {numbers['–¥—É—à–∏']}\n"
        f"–ß–∏—Å–ª–æ –ª–∏—á–Ω–æ—Å—Ç–∏: {numbers['–ª–∏—á–Ω–æ—Å—Ç–∏']}\n"
        f"–ß–∏—Å–ª–æ –∑—Ä–µ–ª–æ—Å—Ç–∏: {numbers['–∑—Ä–µ–ª–æ—Å—Ç–∏']}\n"
    )

    response = openai.ChatCompletion.create(
        model="gpt-4o-mini",
        messages=[{"role": "user", "content": prompt}],
        max_tokens=600
    )

    usage = response.usage
    print(f"[GPT] Prompt tokens: {usage['prompt_tokens']} | Completion tokens: {usage['completion_tokens']} | Total: {usage['total_tokens']}")

    return response.choices[0].message["content"]


def gpt_compatibility(result: dict) -> str:
    prompt = (
        "–¢—ã ‚Äî –Ω—É–º–µ—Ä–æ–ª–æ–≥ –∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º. "
        "–ù—É–∂–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –¥–≤—É—Ö –ª—é–¥–µ–π –ø–æ –∏—Ö —á–∏—Å–ª–∞–º.\n\n"
        "–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:\n"
        "- üîÆ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –∏—Ö —Å–æ—é–∑–∞\n"
        "- ‚ö° –í–æ–∑–º–æ–∂–Ω—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏\n"
        "- üåü –°–æ–≤–µ—Ç—ã –¥–ª—è –≥–∞—Ä–º–æ–Ω–∏—á–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π\n\n"
        "–ü–∏—à–∏ –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º, —Å –ª—ë–≥–∫–æ–π –º–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–æ–π.\n\n"
        f"–ß–∏—Å–ª–∞ –ø–µ—Ä–≤–æ–≥–æ: {result['person1']}\n"
        f"–ß–∏—Å–ª–∞ –≤—Ç–æ—Ä–æ–≥–æ: {result['person2']}\n"
        f"–†–∞–∑–Ω–∏—Ü–∞ –ø–æ —á–∏—Å–ª–∞–º: {result['—Ä–∞–∑–Ω–∏—Ü–∞']}\n"
    )

    response = openai.ChatCompletion.create(
        model="gpt-4o-mini",
        messages=[{"role": "user", "content": prompt}],
        max_tokens=700
    )

    usage = response.usage
    print(f"[GPT] Prompt tokens: {usage['prompt_tokens']} | Completion tokens: {usage['completion_tokens']} | Total: {usage['total_tokens']}")

    return response.choices[0].message["content"]
